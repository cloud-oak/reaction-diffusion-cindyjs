<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="https://cindyjs.org/dist/snapshot/Cindy.js"></script>
		<script type="text/javascript" src="https://cindyjs.org/dist/snapshot/CindyGL.js"></script>
		<title>3dgol</title>
	</head>

	<body>
		<div id="CSCanvas" class="CindyJS-widget" style="position: relative; width: 512px; height: 512px;"></div>
		<script id="csdraw" type="text/x-cindyscript">
			canvas((0, 0), (4096, 0), "state",
				x0 = 256 * mod(t, 16);
				y0 = 256 * floor(t / 16);
				drawimage((x0, y0), (x0 + 256, y0), "current")
			);
			colorplot((-.5, -.5), (255.5, -.5), "current", newstate(#.x, #.y));
			drawimage((0, 0), (4096, 0), "state");
			t = mod(t + 1, 256);
		</script>
		<script id="csinit" type="text/x-cindyscript">
			createimage("state", 4096, 4096);
			createimage("current", 256, 256);
			
			get(tx, ty) := imagergb((-.5, -.5), (255.5, -.5), "current", (tx, ty), interpolate->false, repeat->true).r;
			
			getz(tx, ty) := floor(tx / 256) + 16 * floor(ty / 256);
			
			getx(tx) := mod(tx, 256);
			gety(ty) := mod(ty, 256);
			
			colorplot("current", if(random() > 0.6, 1, 0)); //random stuff as starting image
			
			t = 0;
			nbhds = [(-1,-1), (-1,0), (-1,+1), (0,-1), (0,+1), (+1,-1), (+1,0), (+1,+1)];
			countneighbors(x, y) := sum( apply(nbhds, delta, get(delta.x + x, delta.y + y)));
			
			newstate(x, y) := (
				number = countneighbors(x, y); //number of living neighbors
				if(get(x, y) == 1,
				//if the cell lives then it will die if it has less than 2 neighbours or more than 3 neighbours
				if((number < 2) % (number > 3), 0, 1),
				//if cell was dead then 3 are required to be born
				if(number == 3, 1, 0)
				)
			);
		</script>
		<script type="text/javascript">
			CindyJS({
				scripts: "cs*",
				autoplay: true,
				ports: [{
					id: "CSCanvas",
					width: 512,
					height: 512,
					transform: [{
						visibleRect: [0, 4096, 4096, 0]
					}]
				}]
			});
		</script>
	</body>
</html>
