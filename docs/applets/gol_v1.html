<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="static/Cindy.js"></script>
    <script type="text/javascript" src="static/CindyGL.js"></script>
    <title>Conway's Game of Life in CindyGL</title>
  </head>

  <body>
    <div id="CSCanvas"></div>

    <script id="csinit" type="text/x-cindyscript">
      extent = 128;
      createimage("gol", extent, extent);
      colorplot("gol", if(random() > .6, 1, 0)); //random values as starting image

      get(x, y) := imagergb([0, 0], [extent, 0], "gol", [x, y], interpolate -> false, repeat -> true).r;

      deltas = [(-1,-1), (-1,0), (-1,+1), (0,-1),  (0,+1), (+1,-1), (+1,0), (+1,+1)];
      countneighbors(x, y) := sum( apply(deltas, delta, get(delta.x + x, delta.y + y)));

      newstate(x, y) := (
        number = countneighbors(x, y); //number of living neighbors
        if(get(x, y) == 1,

          //if the cell lives then it will die if it has less than 2 neighbours or more than 3 neighbours
          if((number < 2) % (number > 3), 0, 1),

          //if cell was dead then 3 are required to be born
          if(number == 3, 1, 0)
        )
      );

      tiles = ceil(sqrt(extent));
      EXTENT = tiles*extent;
      createimage("history", EXTENT, EXTENT);
      canvas([0, 0], [EXTENT, 0], "history", drawimage([0, 0], [extent, 0], "gol", interpolate -> false));
      t = 0;
    </script>

    <script id="csdraw" type="text/x-cindyscript">
      colorplot([0, 0], [extent, 0], "gol", newstate(#.x, #.y)); //overwrite texture "gol"
      t = mod(t + 1, extent);
      x = extent*mod(t, tiles);
      y = extent*floor(t/tiles);
      canvas([0, 0], [EXTENT, 0], "history", drawimage([x, y], [x + extent, y], "gol", interpolate -> false));
      drawimage([0, 0], [1, 0], "history", interpolate -> false);
    </script>

    <script type="text/javascript">
    CindyJS({
      scripts: "cs*",
      autoplay: true,
      ports: [{
        id: "CSCanvas",
        width: 512,
        height: 512,
        transform: [{
          visibleRect: [0, 1, 1, 0]
        }]
      }]
    });
    </script>
  </body>
</html>
